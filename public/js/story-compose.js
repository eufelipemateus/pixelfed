(self.webpackChunkpixelfed=self.webpackChunkpixelfed||[]).push([[4822],{13574:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>l});var o=i(24786),n=i(91584),a=(i(42525),i(74692));function s(t){return function(t){if(Array.isArray(t))return r(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return r(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?r(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,o=Array(e);i<e;i++)o[i]=t[i];return o}const l={components:{VueCropper:n.default,VueTimeago:o.default},props:["profile-id"],data:function(){return{loaded:!1,config:window.App.config,mimes:["image/jpeg","image/png","video/mp4"],page:"landing",pages:["landing","crop","edit","confirm","error","uploading","createPoll"],uploading:!1,uploadProgress:0,cropper:{aspectRatio:9/16,viewMode:3,zoomable:!0,zoom:null},mediaUrl:null,mediaId:null,mediaType:null,stories:[],lightboxMedia:!1,duration:10,canReply:!0,canReact:!0,poll:{question:null,options:[]},pollQuestion:null,pollOptions:[],canPostPoll:!1,max_duration:15}},watch:{duration:function(t){"video"==this.mediaType&&(this.$refs.previewVideo.currentTime=t,this.$refs.previewVideo.play())},pollQuestion:function(t){t.length<6&&(this.canPostPoll=!1)},pollOptions:function(t){this.pollOptions.filter((function(t){return t.length>=2})).length>=2?this.canPostPoll=!0:this.canPostPoll=!1}},mounted:function(){var t=this;a("body").addClass("bg-black"),this.mediaWatcher(),setTimeout((function(){axios.get("/api/web/stories/v1/profile/"+t.profileId).then((function(e){e.data.length&&(t.stories=e.data[0].nodes.map((function(t){return t.showViewers=!1,t.viewers=[],t}))),t.loaded=!0}))}),400)},methods:{upload:function(){a('.file-input[name="media"]').trigger("click")},mediaWatcher:function(){var t=this;a(document).on("change","#pf-dz",(function(e){t.triggerUpload()}))},triggerUpload:function(){var t=this;t.uploading=!0;var e=document.querySelector("#pf-dz");t.page="uploading",Array.prototype.forEach.call(e.files,(function(e,i){if(t.media&&t.media.length+i>=t.config.uploader.album_limit)return swal("Error","You can only upload "+t.config.uploader.album_limit+" photos per album","error"),t.uploading=!1,void(t.page=2);var o=e.type;if(-1==a.inArray(o,t.mimes))return swal("Invalid File Type","The file you are trying to add is not a valid mime type. Please upload a "+t.mimes+" only.","error"),t.uploading=!1,void(t.page="error");var n=new FormData;n.append("file",e);var s={onUploadProgress:function(e){var i=Math.floor(100*e.loaded/e.total);t.uploadProgress=i}};e.value=null,axios.post("/api/web/stories/v1/add",n,s).then((function(e){t.uploadProgress=100,t.uploading=!1,t.mediaUrl=e.data.media_url,t.mediaId=e.data.media_id,t.mediaType=e.data.media_type,t.page="video"===e.data.media_type?"preview":"crop",e.data.hasOwnProperty("media_duration")&&(t.max_duration=e.data.media_duration)})).catch((function(i){t.uploading=!1,e.value=null;var o=i.response.data.message?i.response.data.message:i.response.data.error?i.response.data.error:"Something went wrong.";swal("Oops!",o,"warning"),t.page="error"})),t.uploadProgress=0})),document.querySelector("#pf-dz").value=""},expiresTimestamp:function(t){return(t=new Date(1e3*t)).toDateString()+" "+t.toLocaleTimeString()},edit:function(){this.page="edit"},showLightbox:function(t){this.lightboxMedia={url:t.src},this.$refs.lightboxModal.show()},deleteStory:function(t,e){var i=this;1==window.confirm("Are you sure you want to delete this Story?")&&axios.delete("/api/web/stories/v1/delete/"+t.id).then((function(t){i.stories.splice(e,1),0==i.stories.length&&(window.location.href="/i/stories/new")}))},navigateTo:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/";window.location.href=t},goBack:function(){this.page="landing"},performCrop:function(){var t=this;this.page="cropping";var e=this.$refs.croppa.getData();axios.post("/api/web/stories/v1/crop",{media_id:this.mediaId,width:e.width,height:e.height,x:e.x,y:e.y}).then((function(e){t.page="preview"}))},deleteCurrentStory:function(){var t={id:this.mediaId};this.deleteStory(t),this.page="landing"},shareStoryToFollowers:function(){var t=this;this.canPostPoll?axios.post("/api/web/stories/v1/publish/poll",{question:this.pollQuestion,options:this.pollOptions,can_reply:this.canReply,can_react:this.canReact}).then((function(e){window.location.href="/i/my/story?id="+t.mediaId})):axios.post("/api/web/stories/v1/publish",{media_id:this.mediaId,duration:this.duration,can_reply:this.canReply,can_react:this.canReact}).then((function(e){window.location.href="/i/my/story?id="+t.mediaId}))},viewMyStory:function(){window.location.href="/i/my/story"},toggleShowViewers:function(t){this.stories[t].showViewers=!this.stories[t].showViewers},timeago:function(t){return App.util.format.timeAgo(t)},newPoll:function(){this.page="createPoll"},addOptionInput:function(){this.pollOptions.filter((function(t){return t.length<3})).length||this.pollOptions.push([])},pollPreview:function(){var t=this.pollOptions;s(new Set(this.pollOptions)).length==t.length?this.page="preview":swal("Oops!","You cannot use duplicate poll answers, please remove any duplicates and try again.","error")}}}},46721:(t,e,i)=>{"use strict";i.r(e),i.d(e,{render:()=>o,staticRenderFns:()=>n});var o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"story-compose-component container mt-2 mt-md-5 bg-black"},[e("input",{staticClass:"d-none file-input",attrs:{type:"file",id:"pf-dz",name:"media",accept:t.config.mimes}}),t._v(" "),e("span",{staticClass:"fixed-top text-right m-3 cursor-pointer",on:{click:function(e){return t.navigateTo()}}},[e("i",{staticClass:"fal fa-times-circle fa-2x text-lighter"})]),t._v(" "),t.loaded?e("div",{staticClass:"row"},[e("div",{staticClass:"col-12 col-md-6 offset-md-3 bg-dark rounded-lg px-0"},["landing"==t.page?e("div",{staticClass:"card card-body bg-transparent border-0 shadow-none d-flex justify-content-center",staticStyle:{height:"90vh"}},[t._m(0),t._v(" "),e("div",{staticClass:"flex-fill py-4"},[e("p",{staticClass:"text-center lead font-weight-light text-lighter mb-4"},[t._v(t._s(t.$t("story.subtitle")))]),t._v(" "),e("div",{staticClass:"card w-100 shadow-none bg-transparent"},[e("div",{staticClass:"d-flex"},[e("button",{staticClass:"btn btn-outline-light btn-lg font-weight-bold btn-block rounded-pill my-1",attrs:{type:"button",disabled:t.stories.length>=20},on:{click:function(e){return t.upload()}}},[t._v("\n\t\t\t\t\t\t\t\t"+t._s(t.$t("story.add"))+"\n\t\t\t\t\t\t\t")])]),t._v(" "),t.stories.length>=20?e("p",{staticClass:"font-weight-bold text-muted text-center"},[t._v("\n<<<<<<< HEAD\n\t\t\t\t\t\t\tYou have reached the limit for new stories\n=======\n\t\t\t\t\t\t\t"+t._s(t.$t("story.limit"))+"\n>>>>>>> dev\n\t\t\t\t\t\t")]):t._e(),t._v(" "),e("button",{staticClass:"btn btn-outline-light btn-lg font-weight-bold btn-block rounded-pill my-3",attrs:{type:"button",disabled:0==t.stories.length},on:{click:t.viewMyStory}},[t._v("\n<<<<<<< HEAD\n\t\t\t\t\t\t\t"),e("span",[t._v("My Story")]),t._v("\n=======\n\t\t\t\t\t\t\t"),e("span",[t._v(t._s(t.$t("story.myStory")))]),t._v("\n>>>>>>> dev\n\t\t\t\t\t\t\t"),t.stories.length?e("sup",{staticClass:"ml-2 px-2 text-light bg-danger rounded-pill",staticStyle:{"font-size":"12px","padding-top":"2px","padding-bottom":"3px"}},[t._v(t._s(t.stories.length))]):t._e()])])]),t._v(" "),t._m(1)]):"crop"==t.page?e("div",{staticClass:"d-flex justify-content-center flex-fill",staticStyle:{position:"relative",height:"90vh"}},[e("vue-cropper",{ref:"croppa",staticClass:"w-100 h-100 p-0",attrs:{aspectRatio:t.cropper.aspectRatio,viewMode:3,dragMode:"move",autoCropArea:1,guides:!1,highlight:!1,cropBoxMovable:!1,cropBoxResizable:!1,toggleDragModeOnDblclick:!1,src:t.mediaUrl}}),t._v(" "),e("div",{staticClass:"crop-container"},[e("div",{staticClass:"d-flex justify-content-between align-items-center"},[e("button",{staticClass:"btn btn-outline-muted rounded-pill font-weight-bold px-4",attrs:{type:"button"},on:{click:function(e){return t.deleteCurrentStory()}}},[t._v("\n<<<<<<< HEAD\n\t\t\t\t\t\t\tCancel\n\t\t\t\t\t\t")]),t._v(" "),e("div",{staticClass:"text-center"},[e("h4",{staticClass:"font-weight-light text-light mb-n1"},[t._v("Crop")]),t._v(" "),e("span",{staticClass:"small text-light"},[t._v("Pan around and pinch to zoom")]),t._v("\n=======\n\t\t\t\t\t\t\t"+t._s(t.$t("story.cancel"))+"\n\t\t\t\t\t\t"),t._v(" "),e("div",{staticClass:"text-center"},[e("h4",{staticClass:"font-weight-light text-light mb-n1"},[t._v(t._s(t.$t("story.crop")))]),t._v(" "),e("span",{staticClass:"small text-light"},[t._v(t._s(t.$t("story.zoom")))]),t._v("\n>>>>>>> dev\n\t\t\t\t\t\t")]),t._v(" "),e("button",{staticClass:"btn btn-outline-light rounded-pill font-weight-bold px-4",attrs:{type:"button"},on:{click:function(e){return t.performCrop()}}},[t._v("\n<<<<<<< HEAD\n\t\t\t\t\t\t\tNext\n=======\n\t\t\t\t\t\t\t"+t._s(t.$t("story.next"))+"\n>>>>>>> dev\n\t\t\t\t\t\t")])])])])],1):t._e()]),t._v(" "),e("b-modal",{ref:"lightboxModal",staticClass:"bg-transparent",attrs:{id:"lightbox","hide-header":"","hide-footer":"",centered:"",size:"md","body-class":"p-0 bg-transparent"}},[t.lightboxMedia?e("div",{staticClass:"w-100 h-100 bg-transparent"},[e("img",{staticStyle:{"max-height":"90vh",width:"100%","object-fit":"contain"},attrs:{src:t.lightboxMedia.url}})]):t._e()])],1):t._e()])},n=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"text-center flex-fill pt-3"},[e("img",{staticClass:"mb-2",attrs:{src:"/img/pixelfed-icon-color.svg",width:"70",height:"70"}}),t._v(" "),e("p",{staticClass:"lead text-lighter font-weight-light mb-0"},[t._v("Stories")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"text-center flex-fill"},[e("p",{staticClass:"text-uppercase mb-0"},[e("a",{staticClass:"text-lighter font-weight-bold",attrs:{href:"/"}},[t._v("Home")]),t._v(" "),e("span",{staticClass:"px-2 text-lighter"},[t._v("|")]),t._v(" "),e("a",{staticClass:"text-lighter font-weight-bold",attrs:{href:"/site/help"}},[t._v("Help")])]),t._v(" "),e("p",{staticClass:"small text-muted mb-0"},[t._v("v 1.0.0")])])}]},63620:(t,e,i)=>{Vue.component("story-compose",i(75750).default)},33772:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>a});var o=i(76314),n=i.n(o)()((function(t){return t[1]}));n.push([t.id,".bg-black{background-color:#262626}",""]);const a=n},17728:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>a});var o=i(76314),n=i.n(o)()((function(t){return t[1]}));n.push([t.id,".story-compose-component #lightbox .modal-content[data-v-6bc812ca]{background:transparent}.story-compose-component[data-v-6bc812ca] ::-moz-placeholder{color:#ccc}.story-compose-component[data-v-6bc812ca] ::placeholder{color:#ccc}.story-compose-component .crop-container[data-v-6bc812ca]{background:linear-gradient(180deg,rgba(38,38,38,.8),rgba(38,38,38,0));min-height:100px;padding:15px 30px;position:absolute;top:0;width:100%;z-index:9}",""]);const a=n},36923:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>r});var o=i(85072),n=i.n(o),a=i(33772),s={insert:"head",singleton:!1};n()(a.default,s);const r=a.default.locals||{}},49303:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>r});var o=i(85072),n=i.n(o),a=i(17728),s={insert:"head",singleton:!1};n()(a.default,s);const r=a.default.locals||{}},75750:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>s});var o=i(78940),n=i(51737),a={};for(const t in n)"default"!==t&&(a[t]=()=>n[t]);i.d(e,a);i(69156),i(97752);const s=(0,i(14486).default)(n.default,o.render,o.staticRenderFns,!1,null,"6bc812ca",null).exports},51737:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>a});var o=i(13574),n={};for(const t in o)"default"!==t&&(n[t]=()=>o[t]);i.d(e,n);const a=o.default},78940:(t,e,i)=>{"use strict";i.r(e);var o=i(46721),n={};for(const t in o)"default"!==t&&(n[t]=()=>o[t]);i.d(e,n)},69156:(t,e,i)=>{"use strict";i.r(e);var o=i(36923),n={};for(const t in o)"default"!==t&&(n[t]=()=>o[t]);i.d(e,n)},97752:(t,e,i)=>{"use strict";i.r(e);var o=i(49303),n={};for(const t in o)"default"!==t&&(n[t]=()=>o[t]);i.d(e,n)}},t=>{t.O(0,[3660],(()=>{return e=63620,t(t.s=e);var e}));t.O()}]);